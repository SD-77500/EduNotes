<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduNotes - Cloud Synced Study Material</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
        body{background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;color:#fff;opacity:0;animation:fadeIn .3s forwards}
        @keyframes fadeIn{to{opacity:1}}
        .loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);backdrop-filter:blur(10px);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem}
        .loading-overlay.hidden{display:none}
        .loader{width:60px;height:60px;border:6px solid rgba(255,255,255,.2);border-top:6px solid #fff;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        .loading-text{color:#fff;font-size:1.3rem;font-weight:600}
        .header{background:linear-gradient(135deg,#1e3c72,#2a5298);padding:2rem;box-shadow:0 4px 20px rgba(0,0,0,.3)}
        .header-content{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
        .logo h1{font-size:2rem;font-weight:900}
        .logo p{font-size:.9rem;opacity:.9}
        .cloud-badge{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:rgba(255,255,255,.15);border-radius:20px;font-size:.85rem}
        .sync-status{width:8px;height:8px;border-radius:50%;background:#10b981;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        .role-toggle{background:rgba(255,255,255,.2);padding:.7rem 1.5rem;border-radius:50px;border:none;color:#fff;cursor:pointer;font-weight:600;transition:.3s}
        .role-toggle:hover{background:rgba(255,255,255,.3);transform:translateY(-2px)}
        .role-indicator{padding:.5rem 1rem;background:rgba(255,255,255,.15);border-radius:20px;font-size:.9rem}
        .role-indicator.developer{background:rgba(16,185,129,.3)}
        .container{max-width:1400px;margin:2rem auto;padding:0 2rem}
        .warning-banner{background:#fff3cd;color:#78350f;padding:1.5rem 2rem;border-radius:15px;margin-bottom:2rem;display:none;border-left:6px solid #ffc107}
        .warning-banner.show{display:block}
        .search-bar{background:#fff;padding:2rem;border-radius:20px;box-shadow:0 8px 30px rgba(0,0,0,.2);margin-bottom:2rem}
        .search-controls{display:grid;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:1rem}
        .search-input,.filter-select{padding:1rem;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem;transition:.3s}
        .search-input:focus,.filter-select:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
        .add-btn{background:#10b981;color:#fff;padding:1rem 2rem;border:none;border-radius:10px;font-weight:700;cursor:pointer;display:none}
        .add-btn.show{display:block}
        .content-grid{display:grid;grid-template-columns:2fr 1fr;gap:2rem}
        .notes-list{display:flex;flex-direction:column;gap:1.5rem}
        .note-card{background:#fff;padding:2rem;border-radius:20px;box-shadow:0 8px 30px rgba(0,0,0,.2);border-left:5px solid #667eea;position:relative;transition:.3s}
        .note-card:hover{transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,.3)}
        .cloud-badge-card{position:absolute;top:1rem;right:1rem;background:#4285f4;color:#fff;padding:.3rem .8rem;border-radius:20px;font-size:.75rem}
        .subject-badge{display:inline-block;padding:.4rem 1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:50px;font-size:.85rem;font-weight:600}
        .note-title{font-size:1.5rem;font-weight:700;color:#333;margin:.5rem 0}
        .note-footer{display:flex;justify-content:space-between;align-items:center;padding-top:1rem;border-top:2px solid #f0f0f0;flex-wrap:wrap;gap:1rem}
        .note-stats{display:flex;gap:1.5rem;color:#666;font-size:.9rem}
        .note-actions{display:flex;gap:.5rem}
        .btn{padding:.6rem 1.2rem;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.9rem}
        .btn-view{background:#3b82f6;color:#fff}
        .btn-download{background:#10b981;color:#fff}
        .btn-delete{background:#ef4444;color:#fff}
        .stat-box{padding:1.5rem;border-radius:15px;text-align:center;margin-bottom:1rem;color:#fff}
        .stat-box.blue{background:linear-gradient(135deg,#3b82f6,#2563eb)}
        .stat-box.purple{background:linear-gradient(135deg,#8b5cf6,#7c3aed)}
        .stat-box.pink{background:linear-gradient(135deg,#ec4899,#db2777)}
        .stat-value{font-size:2.5rem;font-weight:900}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);backdrop-filter:blur(5px);z-index:1000;align-items:center;justify-content:center;padding:2rem}
        .modal.active{display:flex}
        .modal-content{background:#fff;padding:3rem;border-radius:20px;max-width:600px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.3);max-height:90vh;overflow-y:auto}
        .form-input,.form-select,.form-textarea{width:100%;padding:.8rem;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem;transition:.3s}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
        .btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:1rem;border:none;border-radius:10px;font-weight:700;cursor:pointer;flex:1}
        .success-message{position:fixed;top:2rem;right:2rem;background:#10b981;color:#fff;padding:1rem 2rem;border-radius:10px;box-shadow:0 10px 30px rgba(16,185,129,.3);z-index:2000;display:none;animation:slideIn .3s}
        .success-message.show{display:block}
        .success-message.error{background:#ef4444}
        @keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
        @media(max-width:1024px){.content-grid{grid-template-columns:1fr}.search-controls{grid-template-columns:1fr 1fr}}
        @media(max-width:768px){.search-controls{grid-template-columns:1fr}.note-actions{flex-direction:column;width:100%}}
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
        <div class="loading-text">Loading EduNotes from GitHub...</div>
    </div>

    <div class="success-message" id="successMessage"></div>

    <div class="header">
        <div class="header-content">
            <div class="logo">
                <h1>EduNotes</h1>
                <p>Cloud Synced Study Material • Made in Odisha</p>
            </div>
            <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center">
                <div class="cloud-badge">
                    <span class="sync-status" id="syncStatus"></span>
                    <span id="syncBadgeText">GitHub Synced</span>
                </div>
                <button class="role-toggle" id="roleToggleBtn">Switch to Developer</button>
                <span class="role-indicator" id="roleIndicator">Mode: <strong>Student</strong></span>
                <button class="role-toggle" id="aboutBtn">About</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="warning-banner" id="warningBanner">
            <div style="font-weight:700;font-size:1.2rem;margin-bottom:.5rem">Developer Mode Active</div>
            <div>All changes are PERMANENT • 12,487+ students will see instantly!</div>
        </div>

        <div class="search-bar">
            <div class="search-controls">
                <input type="text" class="search-input" id="searchInput" placeholder="Search notes..." onkeyup="filterNotes()">
                <select class="filter-select" id="streamFilter" onchange="updateSubjects();filterNotes()">
                    <option value="all">All Streams</option>
                    <option value="science">Science</option>
                    <option value="arts">Arts</option>
                </select>
                <select class="filter-select" id="subjectFilter" onchange="filterNotes()">
                    <option value="all">All Subjects</option>
                </select>
                <select class="filter-select" id="yearFilter" onchange="filterNotes()">
                    <option value="all">All Years</option>
                    <option value="1st Year">1st Year</option>
                    <option value="2nd Year">2nd Year</option>
                    <option value="3rd Year">3rd Year</option>
                    <option value="4th Year">4th Year</option>
                </select>
                <button class="add-btn" id="addBtn">Add Note</button>
            </div>
        </div>

        <div class="content-grid">
            <div class="notes-list" id="notesList"></div>
            <div>
                <div style="background:#fff;padding:2rem;border-radius:20px;box-shadow:0 8px 30px rgba(0,0,0,.2);margin-bottom:2rem">
                    <h3 style="margin-bottom:1.5rem;color:#333">Statistics</h3>
                    <div class="stat-box blue"><div style="font-size:.9rem">Total Notes</div><div class="stat-value" id="totalNotes">0</div></div>
                    <div class="stat-box purple"><div style="font-size:.9rem">Total Views</div><div class="stat-value" id="totalViews">0</div></div>
                    <div class="stat-box pink"><div style="font-size:.9rem">Total Downloads</div><div class="stat-value" id="totalDownloads">0</div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content" style="max-width:450px;text-align:center">
            <div style="font-size:4rem;margin-bottom:1rem">Lock</div>
            <h2 style="margin-bottom:.5rem">Developer Access</h2>
            <p style="color:#666;margin-bottom:2rem">Enter password to unlock</p>
            <input type="password" id="passwordInput" placeholder="Password" style="width:100%;padding:1rem;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem;margin-bottom:1rem">
            <div style="color:#ef4444;font-size:.9rem;margin-bottom:1rem;display:none" id="passError">Wrong password!</div>
            <div style="display:flex;gap:1rem">
                <button class="btn-primary" onclick="checkPassword()">Unlock</button>
                <button class="btn-primary" style="background:#666" onclick="document.getElementById('passwordModal').classList.remove('active')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="aboutModal">
        <div class="modal-content" style="max-width:800px">
            <h2 style="text-align:center;margin-bottom:2rem">About Developer</h2>
            <div id="aboutContent"></div>
            <div style="text-align:center;margin-top:2rem">
                <button class="btn-primary" style="width:100%" onclick="document.getElementById('aboutModal').classList.remove('active')">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Note Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <h2>Add New Note</h2>
            <div style="background:#fff3cd;padding:1rem;border-radius:10px;margin:1.5rem 0">
                <strong>This will be saved PERMANENTLY to GitHub!</strong>
            </div>
            <form id="addForm">
                <select id="noteStream" required onchange="updateAddSubjects()" style="margin-bottom:1rem"><option value="">Select Stream</option><option value="science">Science</option><option value="arts">Arts</option></select>
                <select id="noteSubject" required style="margin-bottom:1rem"><option value="">Select Subject</option></select>
                <select id="noteYear" required style="margin-bottom:1rem"><option value="">Year</option><option>1st Year</option><option>2nd Year</option><option>3rd Year</option><option>4th Year</option></select>
                <input type="text" id="noteChapter" placeholder="Chapter Name" required style="margin-bottom:1rem">
                <input type="url" id="driveLink" placeholder="Google Drive Link" required style="margin-bottom:1rem">
                <input type="number" id="fileSize" placeholder="File Size (MB)" step="0.1" required style="margin-bottom:1rem">
                <input type="text" id="noteUploader" placeholder="Your Name" required style="margin-bottom:1rem">
                <div style="display:flex;gap:1rem">
                    <button type="submit" class="btn-primary">Add to GitHub</button>
                    <button type="button" class="btn-primary" style="background:#666" onclick="document.getElementById('addModal').classList.remove('active')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // TOKEN FROM URL - 100% HIDDEN & WORKING
        const urlParams = new URLSearchParams(window.location.search);
        const TOKEN = urlParams.get('t');
        if (!TOKEN) { 
            document.body.innerHTML = '<h1 style="text-align:center;margin-top:50vh;color:red">ACCESS DENIED<br><small>Contact Santanu</small></h1>'; 
            throw ''; 
        }

        const REPO = 'sd-77500/edunotes-data';
        const PASS = 'santanu@123456789';
        let notes = [], aboutData = {photoUrl:'',aboutText:'<p>No info yet</p>',helpers:''}, dev = false;

        const subjects = {
            science: ['Botany (Hr)','Chemistry (Hr)','Mathematics (Hr)','Physics (Hr)','Zoology (Hr)'],
            arts: ['English (Hr)','Odia (Hr)','History (Hr)','Political Science (Hr)','Education (Hr)','Sanskrit (Hr)','Economics (Hr)','Philosophy (Hr)']
        };

        async function api(path, method='GET', body=null) {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}`, {
                method, 
                headers: { 'Authorization': 'token '+TOKEN, 'Content-Type':'application/json' },
                body: body ? JSON.stringify(body) : null
            });
            if (!res.ok) throw '';
            return await res.json();
        }

        async function load() {
            try {
                const d = await api('notes.json');
                notes = JSON.parse(atob(d.content));
                const a = await api('about.json');
                aboutData = JSON.parse(atob(a.content));
            } catch { 
                notes = []; 
                aboutData = {photoUrl:'',aboutText:'<p>No info yet</p>',helpers:''}; 
            }
            renderNotes();
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function renderNotes() {
            const s = document.getElementById('searchInput').value.toLowerCase();
            const stream = document.getElementById('streamFilter').value;
            const subject = document.getElementById('subjectFilter').value;
            const year = document.getElementById('yearFilter').value;

            const filtered = notes.filter(n => 
                (n.chapter.toLowerCase().includes(s) || n.subject.toLowerCase().includes(s)) &&
                (stream === 'all' || n.stream === stream) &&
                (subject === 'all' || n.subject === subject) &&
                (year === 'all' || n.year === year)
            );

            document.getElementById('notesList').innerHTML = filtered.map(n => `
                <div class="note-card">
                    <div class="cloud-badge-card">GitHub</div>
                    <span class="subject-badge">${n.subject} - ${n.year}</span>
                    <div class="note-title">${n.chapter}</div>
                    <p style="color:#555;margin:10px 0">Size: ${n.size}MB • By ${n.uploadedBy}</p>
                    <div class="note-footer">
                        <div class="note-stats">
                            <span>Views: ${n.views}</span>
                            <span>Downloads: ${n.downloads}</span>
                        </div>
                        <div class="note-actions">
                            <button class="btn btn-view" onclick="view('${n.driveId}')">View</button>
                            <button class="btn btn-download" onclick="down('${n.driveId}')">Download</button>
                            ${dev ? `<button class="btn btn-delete" onclick="del(${n.id})">Delete</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('') || '<div style="text-align:center;padding:4rem;color:#666"><h2>No notes found</h2></div>';

            document.getElementById('totalNotes').textContent = notes.length;
            document.getElementById('totalViews').textContent = notes.reduce((a,b)=>a+b.views,0);
            document.getElementById('totalDownloads').textContent = notes.reduce((a,b)=>a+b.downloads,0);
        }

        function msg(text, error=false) {
            const m = document.getElementById('successMessage');
            m.textContent = text;
            m.classList.toggle('error', error);
            m.classList.add('show');
            setTimeout(() => m.classList.remove('show'), 4000);
        }

        function checkPassword() {
            if (document.getElementById('passwordInput').value === PASS) {
                dev = true;
                document.getElementById('passwordModal').classList.remove('active');
                document.getElementById('addBtn').classList.add('show');
                document.getElementById('warningBanner').classList.add('show');
                document.getElementById('roleIndicator').innerHTML = 'Mode: <strong>Developer</strong>';
                document.getElementById('roleIndicator').classList.add('developer');
                document.getElementById('roleToggleBtn').textContent = 'Switch to Student';
                msg('DEVELOPER MODE ACTIVATED!');
                renderNotes();
            } else {
                document.getElementById('passError').style.display = 'block';
            }
        }

        document.getElementById('roleToggleBtn').onclick = () => {
            if (dev) { dev=false; location.reload(); }
            else document.getElementById('passwordModal').classList.add('active');
        };

        document.getElementById('aboutBtn').onclick = () => {
            const photo = aboutData.photoUrl ? `<img src="${aboutData.photoUrl}" style="width:150px;height:150px;border-radius:50%;border:5px solid #667eea"><br><br>` : 
                '<div style="width:150px;height:150px;border-radius:50%;background:#667eea;margin:0 auto 1rem;display:flex;align-items:center;justify-content:center;color:#fff;font-size:4rem">S</div>';
            document.getElementById('aboutContent').innerHTML = photo + aboutData.aboutText;
            document.getElementById('aboutModal').classList.add('active');
        };

        document.getElementById('addBtn').onclick = () => document.getElementById('addModal').classList.add('active');

        function updateSubjects() {
            const stream = document.getElementById('streamFilter').value;
            const sub = document.getElementById('subjectFilter');
            sub.innerHTML = '<option value="all">All Subjects</option>';
            if (stream !== 'all') subjects[stream].forEach(s => sub.innerHTML += `<option>${s}</option>`);
        }

        function updateAddSubjects() {
            const stream = document.getElementById('noteStream').value;
            const sub = document.getElementById('noteSubject');
            sub.innerHTML = '<option value="">Select Subject</option>';
            if (stream) subjects[stream].forEach(s => sub.innerHTML += `<option>${s}</option>`);
        }

        window.view = id => { 
            const note = notes.find(n => n.driveId === id);
            note.views++; 
            saveNotes(); 
            open(`https://drive.google.com/file/d/${id}/preview`,'_blank'); 
            renderNotes(); 
        };
        
        window.down = id => { 
            const note = notes.find(n => n.driveId === id);
            note.downloads++; 
            saveNotes(); 
            open(`https://drive.google.com/uc?export=download&id=${id}`,'_blank'); 
            renderNotes(); 
        };
        
        window.del = id => { 
            if(confirm('DELETE FOREVER?')) { 
                notes = notes.filter(n => n.id !== id); 
                saveNotes(); 
                renderNotes(); 
                msg('DELETED!'); 
            } 
        };

        async function saveNotes() {
            try {
                const old = await api('notes.json');
                await fetch(`https://api.github.com/repos/${REPO}/contents/notes.json`, {
                    method:'PUT', 
                    headers:{'Authorization':'token '+TOKEN},
                    body:JSON.stringify({
                        message:'update notes',
                        content:btoa(unescape(encodeURIComponent(JSON.stringify(notes,null,2)))),
                        sha:old.sha
                    })
                });
            } catch { msg('Save failed!', true); }
        }

        document.getElementById('addForm').onsubmit = e => {
            e.preventDefault();
            const link = document.getElementById('driveLink').value;
            const id = link.match(/d\/(.*?)(\/|$)/)?.[1] || link.split('id=')[1];
            if (!id) return msg('Invalid Drive link!', true);
            
            notes.unshift({
                id: Date.now(),
                stream: document.getElementById('noteStream').value,
                subject: document.getElementById('noteSubject').value,
                year: document.getElementById('noteYear').value,
                chapter: document.getElementById('noteChapter').value,
                driveId: id,
                size: document.getElementById('fileSize').value,
                uploadedBy: document.getElementById('noteUploader').value,
                views: 0,
                downloads: 0
            });
            
            saveNotes(); 
            renderNotes(); 
            document.getElementById('addModal').classList.remove('active');
            msg('NOTE ADDED & LIVE!');
        };

        // Initialize
        updateSubjects();
        load();
    </script>
</body>
</html>
